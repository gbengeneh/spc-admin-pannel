import {
  createCategory,
  deleteCategory,
  imageUploadHandler,
  updateCategory,
} from '@/actions/categories';
import { useRouter } from 'next/navigation';
import { toast } from 'sonner';
const submitCategoryHandler: SubmitHandler<createCategorySchema> = async data => {
    const { image, name, intent = 'create' } = data;

    const handleImageUpload = async () => {
      const uniqueId = uuid();
      const fileName = `category/category-${uniqueId}`;
      const file = new File([data.image[0]], fileName);
      const formData = new FormData();
      formData.append('file', file);

      return imageUploadHandler(formData);
    };

    switch (intent) {
      case 'create': {
        const imageUrl = await handleImageUpload();

        if (imageUrl) {
          await createCategory({ imageUrl, name });
          form.reset();
          router.refresh();
          setIsCreateCategoryModalOpen(false);
          toast.success('Category created successfully');
        }
        break;
      }
      case 'update': {
        if (image && currentCategory?.slug) {
          const imageUrl = await handleImageUpload();

          if (imageUrl) {
            await updateCategory({
              imageUrl,
              name,
              slug: currentCategory.slug,
              intent: 'update',
            });
            form.reset();
            router.refresh();
            setIsCreateCategoryModalOpen(false);
            toast.success('Category updated successfully');
          }
        }
      }

      default:
        console.error('Invalid intent');
    }
  };

  const deleteCategoryHandler = async (id: number) => {
    await deleteCategory(id);
    router.refresh();
    toast.success('Category deleted successfully');
  };